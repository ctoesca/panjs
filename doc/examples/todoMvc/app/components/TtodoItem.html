<html>        
<head>

<script data-subtype="text/x-class-definition">
//<![CDATA[

defineClass("TtodoItem", "panjs.core.display.Telement", { 

	baseElement: "li",	
	model: null,
	todo:null,

	constructor: function(args){ 
		this._super.constructor.call(this,args);
		this.model = args.model;
	},

	setData: function( todo){
		this.todo = todo;
		this.render();		
	},
	getData: function( todo){
		return this.todo;
	},

	render: function(){
		this.label1.text(this.todo.body);
		this.edit1.val(this.todo.body);
		this.checkbox1.prop("checked", this.todo.completed);
		this.container.toggleClass("completed", this.todo.completed);
	},

	//Events from UI
	onDestroyClick: function(e){
		this.model.removeTodo(this.todo);
	},

	onToggleCompletedClick: function(e){
		this.model.updateTodo(this.todo, {completed: $(e.target).prop("checked")});
	},

	onStartEditingClick: function(e){
		
		this.container.addClass("editing");
		this.edit1.focus();
			
		//cursor at end (FF)
		this.edit1.val("");
		this.edit1.val(this.todo.body);
	},
	
	onEndEditing: function(e){	
		var value = this.edit1.val().trim();
		if (value == "")
			this.model.removeTodo(this.todo);
		else
			this.model.updateTodo(this.todo, {body: this.edit1.val()});	
		this.container.removeClass("editing");
	},

	onEditKeyUp: function(e){

		if (e.which === 27){
			this.edit1.val(this.todo.body);
			this.onEndEditing(e);
		}
		else if (e.which === 13)
			this.onEndEditing(e);
	}
});

//]]>
</script>

</head>

<body>
		<div class="view">
			<input id="checkbox1" data-onclick="this.onToggleCompletedClick" class="toggle" type="checkbox" checked="checked" />
			<label id="label1" data-ondblclick="this.onStartEditingClick"></label>
			<button id="btn1" data-onclick="this.onDestroyClick" class="destroy"></button>
		</div>
		<input class="edit" id="edit1" value="" data-onchange="this.onEndEditing" data-onkeyup="this.onEditKeyUp" data-onblur="this.onEndEditing" />
</body>
</html> 
