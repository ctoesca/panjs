<html>        
<head>
<script>
	var CKEDITOR_BASEPATH = '/libs/ckeditor/4.0/';
</script>
<script src="/libs/ckeditor/4.0/ckeditor.js"></script>
<script src="/libs/ckeditor/4.0/adapters/jquery.js"></script>


<style type="text/less">
.Teditor{
	
}
</style>

<script type="text/x-class-definition">
//<![CDATA[


defineClass("Teditor", "core.display.Telement", { 

	baseElement: "div",	
	textarea: null,
	editorId: null,
	baseHref: null,

	constructor: function(args){
		this._super.constructor.call(this,args);
		//this.submit.on("click", this.onSave.bind(this));
		
		if (typeof args != "undefined")
		{
			if (typeof args.baseHref != "undefined")
				this.baseHref =  args.baseHref ;
		}
		this.textarea = this.container.getElement("textarea");
		
		this.editorId = "editor"+this.id;
		this.textarea.attr("name", this.editorId); // affectation de l'id qui sera transmis dans la requete post
												// cet id est passé en param de ce composant, mais on ne peut pas changer le id d'un élément (framework). c'est possible mais pas recommandé.

		/*CKEDITOR.stylesSet.add( 'default', [
		    // Block-level styles
		    { name: 'Blue Title', element: 'h2', styles: { 'color': 'Blue' } },
		    { name: 'Red Title' , element: 'h3', styles: { 'color': 'Red' } },
			{ name: 'Well' , element: 'div', attributes: { 'class': 'well' }  },

		    // Inline styles
		    { name: 'CSS Style', element: 'span', attributes: { 'class': 'my_style' } },
		    { name: 'Marker: Yellow', element: 'span', styles: { 'background-color': 'Yellow' } }
		]);*/

		this.container.getElement("textarea").ckeditor(
		{
			baseHref: this.baseHref,
			onSave: this._onSave.bind(this),
			onClose: this._onClose.bind(this),
			stylesSet: [
			{ name: 'Well' , element: 'div', attributes: { 'class': 'well' }  },
			{ name: 'Alert success' , element: 'div', attributes: { 'class': 'alert alert-success' }  },
			{ name: 'Alert danger' , element: 'div', attributes: { 'class': 'alert alert-danger' }  },
			{ name: 'label primary' , element: 'span', attributes: { 'class': 'label label-primary' }  },
			{ name: 'Page header' , element: 'div', attributes: { 'class': 'page-header' }  },
			{ name: 'small' , element: 'small'  },
			{ name: 'table' , element: 'table',  attributes: { 'class': 'table table-bordered table-responsive table-striped' }  },
		
			
			],
			contentsCss : '/libs/twitter-bootstrap/3.0.0/css/bootstrap.css'
		});

      if (this.editor == null)
      {
      		CKEDITOR.on('instanceReady',
      		function( evt )
	      {
	      	this.instanceIsReady = true;
	         var editor = evt.editor;
	         //editor.execCommand('maximize');
	         this.resize();
	      }.bind(this));

			this.editor = CKEDITOR.instances[this.editorId];
      }
     
	},
	setBaseHref: function(baseHref){
		alert(baseHref);
		this.editor.ckeditorGet().config.baseHref=baseHref;
	},
	show: function(args)
	{
		this._super.show.call(this, args);
		this.resize();
	},
	resize:function()
	{
		try{
			if (!this.instanceIsReady)
				return;
			
		var el = this.container.getElement("#cke_"+this.editorId);
		if (el == null)
			return;
		var h = this.container.parent().height();//$(window).height();
		var y = el.offset().top;
		var height = h;//h - y - 80;
		if (height < 500)
			height = 500;
		
 		this.editor.resize( '100%', height );
 		logger.debug("HEIGHT EDITOR = "+height);

 		}catch(err){
 			logger.error("ERREUR RESIZE EDITOR: "+err);
 		}
	},
	maximize:function()
	{
		if (this.editor != null)
   		this.editor.execCommand('maximize');
	},
	_onSave: function(e)
	{
		this.dispatchEvent( new Tevent("ON_SAVE", this));
			
	},
	_onClose: function(e){
		var state = CKEDITOR.instances[this.editorId].commands.maximize.state; //1=FullScree, 2=Normal
		if (state == 1)
		this.editor.execCommand('maximize');
		this.dispatchEvent( new Tevent(Tevent.CLOSE, this));
			
	},
	setContent: function(value) {
		// Get the editor instance that we want to interact with.
		
		//var value = document.getElementById( 'htmlArea' ).value;

		// Set editor contents (replace current contents).
		// http://docs.ckeditor.com/#!/api/CKEDITOR.editor-method-setData
		this.editor.setData( value );
	},

	getContent: function() {

		return  this.editor.getData();
	}

});

//]]>
</script>

</head>

<body>	 

	<textarea>	
	</textarea>
	
</body>
</html>

