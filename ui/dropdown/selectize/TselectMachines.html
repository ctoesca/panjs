<html>        
<head>


<script type="text/x-class-definition">
//<![CDATA[
              
defineClass("TselectMachines", "ui.dropdown.selectize.Tselectize.html", { 
	
	/* ARGS */	
	valueField: "id",
	labelField: "nom",
	placeholder: "Entrer une/des machines",

	_vmlist: null,
	_mplist: null,

	constructor: function(args){
		
		this._super.constructor.call(this,args);
		this.container.hide();

		//uses("cmdb.components.itemsRenderers.TmachinesRenderer");
		//this.cellRenderer = new TmachinesRenderer();	
		app.getService().searchMachinesVirtuelles("where=("+this.labelField+" <> '')&orderBy="+this.labelField+"&fields=id,nom,isVm", this._onVmLoaded.bind(this), null, {useCache:true});
		app.getService().searchMachinesPhysiques("where=("+this.labelField+" <> '')&orderBy="+this.labelField+"&fields=id,nom,isVm", this._onMpLoaded.bind(this), null, {useCache:true});

	},
	_onMpLoaded: function(data){
		this._mplist = data.data;
		this.init();
	},
	_onVmLoaded: function(data){
		this._vmlist = data.data;
		this.init();
	},
	init: function(){


		if ((this._vmlist != null) && (this._mplist != null))
		{
			var arr = this._vmlist._items.concat(this._mplist._items);
			this.setDataProvider( new TarrayCollection(arr));
		}
	},
	
	renderItem: function(item, escape) {

		if (item.isVm == 0)
			return '<div class="item"><img src="/libs/icons/16/servers.png" style="vertical-align: text-top;" /> '+item.nom+'</div>';
		else
			//return '<div class="item"><img src="/libs/icons/16/servers.png" style="vertical-align: text-top;"/> '+item.nom+'</div>';
			return '<div class="item"><img src="/libs/icons/16/vm-icon.jpg" style="vertical-align: text-top;"/> '+item.nom+'</div>';
		
	}
});
//]]>
</script>


</head>
</html> 

