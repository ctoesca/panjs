<html>        
<head>

<style type="text/less">	
.Tdropdown
{
		button.readonly{
			cursor: not-allowed;
			/*opacity:1;
			pointer-events: none;
			
			-webkit-box-shadow: none;
			box-shadow: none;
			border-style:none;
			padding-left:0px;
			background-color: inherit;*/
		}
		button.error
		{
			border-color:red;
		}
		button.dropdown-toggle{
			white-space: normal;
			text-align: left;
		}
}
</style>

<script data-subtype="text/x-class-definition">
//<![CDATA[

uses("panjs.core.collections.TarrayCollection");
             
defineClass("Tdropdown", "panjs.ui.dropdown.TdropdownBase.html", { 
	
	errorElement: null,

	/* METHODES */
	constructor: function(args){
		Tdropdown._super.constructor.call(this,args);

		this.container.addClass("btn-group");

		if (this._maxWidth){

			this.container.css("max-width", this._maxWidth);
			this.button.css("max-width", this._maxWidth);
		}

	},

	setReadonly: function(value)
	{
		if (this._readonly != value)
		{
			this._readonly = value;
			if (value == true)
			{
				this.button.addClass("readonly");
				this.caret.hide();
			}
			else
			{
				this.button.removeClass("readonly");
				this.caret.show();	
			}
		}
	},
	showErrorText: function(v){
        this.container.html('<div class="alert alert-danger" role="alert" style="font-size:0.9em">'+v+'</div>');
    }, 
	showError: function(message)
	{
		this.button.addClass("error");		
		if (arguments.length >0){
			if (this.errorElement!=null)
				this.errorElement.remove();
			this.errorElement = $('<p class="text-danger pull-left " style="margin-left:10px;">'+message+'</p>');

			this.container.append(this.errorElement);
		}
	},
	hideError: function()
	{
		if (this.errorElement != null)
		this.errorElement.remove();
		this.button.removeClass("error");
	},
	_setLabel: function(item)
	{
		this.label.html(this.labelFunction(item));
	},

	_close: function()
	{
		this.container.removeClass("open");
	},
	_open: function()
	{
		this.container.addClass("open");
	},
	
	_empty: function()
	{
		this.ul.html("");
		this._itemsCount = 0;
	},

	_setEvents: function()
	{
		this.ul.on("click", this._onItemClick.bind(this));
	},

	_addItem:function(obj)
	{
		//Ajoute: <li><a href="#">AFPA Bernes</a></li>
		if (obj != null)
		{
			var t = obj[this.labelField];
			if (typeof t == "undefined")
				t = "labelField incorrect";

			if (t != null)
			{
				if (this.capitalizeFirstLetter)
					t = t.capitalizeFirstLetter();
				this._itemsCount ++;
			}else
			{
				t = this.nullLabelItem;
			}
			
			var li = $('<li><a style="height:25px;" href="#">'+t+'</a></li>');
			var a = li.getElement("a");

			a.prop("data",obj);

			if (obj === this._selectedItem)
			{	
				this._setLabel(obj);	
			}

		}
		else
		{
			var li = $('<li class="divider"></li>');
		}
		this.ul.append(li);

	},
	_onItemClick:function(e)
	{
		if (!this._isReady()) return;

		if (this._readonly){
			e.preventDefault();
			return;	
		}else{
			var cell = $(e.target).closest( "a" )
			if ((cell.length>0) && (cell[0].nodeName == "A"))
				this.setSelectedItem(cell.prop("data"));
			this._close();			
		}
		return false;
	},
	
	enabled: function(value)
	{
		if (arguments.length == 0)
		{
			return (this.button.hasClass("disabled") == false);
		}
		else
		{
			if (value === true)
			this.button.removeClass("disabled")
			else
			this.button.addClass("disabled");
		}		
	}

});

//]]>
</script>

</head>

<body>	 

  <button id="button" type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
  
    <span id="label"/> <span class="caret" id="caret"></span>

  </button>
  <ul class="dropdown-menu " role="menu" id="ul" >   
  </ul>
<!--CONTENT-->
</body>
</html>

