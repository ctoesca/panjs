 <html>        
<head>
<style type="text/less">

.Ttabnav2{
	div.tab-content{
		/*padding-top:10px;*/
		/*overflow-y:auto;
		overflow-x:hidden;*/
		/*ACE: padding: 16px 12px; */
		padding-top: 16px;

	}
	.tab-pane{
		height: 100%;
	}
}


</style>

<script data-subtype="text/x-class-definition">

//<![CDATA[      

defineClass("Ttabnav2", "panjs.core.display.Telement", { 

	baseElement: "div",	
	tabs: null,
	selectedIndex: 0,
	headersStyle: null,
	headersClass: null,
	autoloadComponents: true,
	
	constructor: function(args)
	{	
		this._super.constructor.call(this,args);
		this.tabs = [];

		if (defined(args, "selectedIndex"))
			this.selectedIndex = args["selectedIndex"];
		if (defined(args, "headersStyle"))
			this.headersStyle = args["headersStyle"];
		if (defined(args, "headersClass"))
			this.headersClass = args["headersClass"];
		if (defined(args, "autoloadComponents"))
			this.autoloadComponents = args["autoloadComponents"];


		/* Attention sur IE childnodes bouge quand on modifie le conteneur */
		var tabIndx = -1;
		for (var i=0; i < this.content[0].childNodes.length; i++)
		{
			var node = this.content[0].childNodes[i];

			if (node.nodeType == 1)
			{	
				tabIndx ++;
				el = $(node);
				var id = el.attr("id");			
				el.attr("id", this.container.attr("id")+"_tab"+tabIndx);
				this._createTab(el);	
			}	
		}
	
		this.selectTab(this.selectedIndex);

		var hCss = this.container.css("height") ;
		if ((hCss != "auto")&&(hCss != "0px")){
			$(window).resize( this.resize.bind(this));
			this.resize();
		}
	},
	resize: function(){
		var h = this.container.height() - this.myTab.height();
		logger.debug("container.height="+this.container.height()+" , myTab.height="+this.myTab.height()+" , h="+h);
		this.tabContent.css("height", h+"px");
	},
	/*_populateElements: function(element, setObject, r)
	{	
		logger.debug("DEBUT _populateElements ***************** "+element.outerHTML);
		var r = this._super._populateElements.call(this, element, setObject, r);
		logger.debug("FIN _populateElements ***************** "+element.outerHTML);
		return r;
	},*/
	addTab: function(opt){
		var el;
		if (opt.html){
			el = $(opt.html);
		}
		else{

			if (opt.el instanceof jQuery)
			{
				el = opt.el;
			}else{
				if (opt.el instanceof TdisplayObject)
					el = opt.el.container;
				else
					throw "addTab: opt.el type unknown";
			}
		}
		var tabIndx = this.tabs.length;
		var id = el.attr("id");	
		el.attr("id", this.container.attr("id")+"_tab"+tabIndx);

		var label = el.attr("label");
		if (label == null){
			if (typeof opt.label  != "undefined"){
				el.attr("label", opt.label);
			}else{

			}
		}
		
		var autoloadComponents = el.attr("data-autoload-components");
		if (autoloadComponents == null)
			if (typeof opt.autoloadComponents != "undefined")
				el.attr("data-autoload-components", opt.autoloadComponents);

		return this._createTab(el);	

	},
    _createTab: function(el)
	{
	
		var label = el.attr("label");
		if (label == null){
			var labelElement = el.getElement("label");

			if (labelElement == null){
				label = el.attr("id");
			}
			else{
				label = labelElement.html();
				labelElement.remove();
			}
		}

		var autoloadComponents = this.autoloadComponents;
		if (el.attr("data-autoload-components") != null)
			autoloadComponents = (el.attr("data-autoload-components") == "true");

		var visible = false;
		if (el.attr("visible") != "false") visible = true;
		
		el.addClass("tab-pane");


		var headersStyle = "";	
		if (this.headersStyle != null)
			headersStyle = this.headersStyle;

		var headersClass = "";	
		if (this.headersClass != null)
			headersClass = this.headersClass;

		var li = $('<li style="'+headersStyle+'" class="'+headersClass+'"/>');
		if (visible == false)
			li.css("display", "none");
			
		var a = $('<a href="#'+el.attr("id")+'" tabIndex="'+(this.tabs.length)+'" data-toggle="tab">'+label+'</a>');
		a.on('show.bs.tab', this.onTabClick.bind(this));

		li.append(a);
		this.myTab.append(li);
		this.tabContent.append(el);
		var tab = {elem:el, link:a, li: li, visible: visible, subComponentsLoaded: false, autoloadComponents: autoloadComponents};
		this.tabs.push(tab);
		return tab;
	},
	getTabByIndex: function(indx){
		return this.tabs[indx];
	},
	setLabel: function(tab, value){
		//!! bind sur objet tab
		tab.link.html(value);
	},
	onTabClick: function(e)
	{
		var a = $(e.target);
		var indx = a.attr("tabIndex");
		this.selectTab(indx);
		e.preventDefault();
		return false;
	},

	_inactivateAll: function()
	{
		for (var i=0; i<this.tabs.length; i++){
			this.tabs[i].elem.removeClass("active");
			this.tabs[i].link.removeClass("active");
			this.tabs[i].li.removeClass("active");
		}
	},
	loadSubComponents: function(tab)
	{
		
		if  ((this.parent == null)||(tab.subComponentsLoaded)|| (tab.autoloadComponents == false))
			return;
				
		var composToLoad = tab.elem.getElements('[data-autoload="false"]');
		for (var i = 0; i < composToLoad.length; i++) {
			var compo = composToLoad[i];

			var origId = compo[0].getAttribute("data-original-id");
			if (origId)
				this.parent[origId].load();
		};
		tab.subComponentsLoaded = true;
		/* on ne charge que les composants de 1er niveau */
		/*for (var i=0; i < tab.elem[0].childNodes.length; i++)
		{
			var el = tab.elem[0].childNodes[i];
			if ((el.nodeType == 1) && (el.getAttribute("autoload") == "false"))
			{
				if (typeof el.originalId != "undefined")
					this.parent[el.originalId].load();
			}
		}
		
		tab.subComponentsLoaded = true;*/
	},

	selectTab: function(indx)
	{
		var tab = this.tabs[indx];
		if (tab.visible == false)
			this.showTab(indx);

		this.loadSubComponents(tab);

		this._inactivateAll();
		tab.link.parent().addClass("active");
		tab.link.focus();
		tab.elem.addClass("active");
		if (this.selectedIndex != indx)
		{
			this.selectedIndex = indx;
			this.dispatchEvent(new Tevent("TAB_CHANGE", {tab: tab.elem, indx:indx}));
		}
		
	},

	hideTab: function(indx)
	{
		var tab = this.tabs[indx];		
		tab.li.hide();
		tab.visible = false;
	},
	showTab: function(indx)
	{
		var tab = this.tabs[indx];		
		tab.li.show();
		tab.visible = true;
	}
	
	

});
//]]>
</script>

</head>
<body>	
	
	
	<ul id="myTab" class="nav nav-tabs">
	
	</ul>
	<div id="tabContent" class="tab-content">
		<!--CONTENT-->
	</div>

</body>
</html> 
